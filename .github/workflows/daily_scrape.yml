name: Gunluk Trend Takipcisi

on:
  schedule:
    # Her gün sabah 09:00 ve akşam 21:00'de çalışır (UTC saatiyle)
    - cron: '0 6,18 * * *'
  workflow_dispatch: # GitHub üzerinden manuel butonla çalıştırmak için

jobs:
  scrape-and-process:
    runs-on: ubuntu-latest

    steps:
    - name: Depoyu Çek (Checkout)
      uses: actions/checkout@v3

    - name: Python Kurulumu (3.11)
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Chrome ve Chromedriver Kurulumu
      run: |
        sudo apt-get update
        sudo apt-get install -y chromium-browser chromium-chromedriver
        which chromium-browser
        which chromedriver
    - name: Kütüphaneleri Yükle
      run: |
        python -m pip install --upgrade pip
        # Scraper klasöründeki gereksinimleri yükle
        pip install -r scraper/requirements.txt
    - name: Ustabaşı Scriptini Çalıştır
      env:
        # Bu şifreleri GitHub ayarlarından çekecek
        OPENROUTER_KEY: ${{ secrets.OPENROUTER_KEY }}
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      run: |
        # Main scripti çalıştır
        python scraper/main.py


        # --- DOSYA KAYDETME BÖLÜMÜ ---
    - name: Sonuçları Yükle (Artifact Upload)
      if: always() # Hata alsa bile eğer dosya oluşmuşsa yüklemeyi dener
      uses: actions/upload-artifact@v4
      with:
        name: n11-sonuclari
        path: scraper/n11_sonuc.csv
        retention-days: 5 # Dosya 5 gün boyunca indirilebilir kalır